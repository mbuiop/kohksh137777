name: Build Kohksh for Linux

on: [push, pull_request, workflow_dispatch]

jobs:
  build-linux:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Install ALL dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          build-essential \
          autoconf \
          automake \
          libtool \
          pkg-config \
          cmake \
          # Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ
          libsdl2-dev \
          libgl1-mesa-dev \
          libglu1-mesa-dev \
          libglew-dev \
          # Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ ØµÙˆØªÛŒ
          libopenal-dev \
          libalut-dev \
          libvorbis-dev \
          libflac-dev \
          # Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ú†Ù†Ø¯Ø±Ø³Ø§Ù†Ù‡â€ŒØ§ÛŒ
          libavcodec-dev \
          libavformat-dev \
          libavutil-dev \
          libswscale-dev \
          # Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…
          libx11-dev \
          libxrandr-dev \
          libxi-dev \
          libxcursor-dev \
          libxinerama-dev
    
    - name: Build with CMake
      run: |
        mkdir -p cmake-build
        cd cmake-build
        cmake .. -DCMAKE_BUILD_TYPE=Release
        make -j$(nproc)
    
    - name: Build with Make (Alternative)
      run: |
        chmod +x build.sh
        ./build.sh
    
    - name: Check built binaries
      run: |
        echo "ğŸ“ Built files:"
        find . -name "kohksh" -type f | head -5
        find . -name "*.so" -type f | head -5
        find . -name "*.a" -type f | head -5
    
    - name: Upload Linux Binary
      uses: actions/upload-artifact@v4
      with:
        name: kohksh-linux
        path: |
          kohksh
          cmake-build/kohksh
