name: ğŸ”¥ Build Kohksh Heavy Game - Complete
on: 
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build-heavy-game:
    name: ğŸ—ï¸ Build Heavy Game APK
    runs-on: ubuntu-latest
    timeout-minutes: 45
    
    env:
      PROJECT_ROOT: /home/runner/work/kohksh137777/kohksh137777
      GAME_ENGINE_DIR: /home/runner/work/kohksh137777/kohksh137777/Engine
      GAME_CODE_DIR: /home/runner/work/kohksh137777/kohksh137777/Game  
      SDL_LIB_PATH: /home/runner/work/kohksh137777/kohksh137777/SDL2.zip
      MAIN_CPP_PATH: /home/runner/work/kohksh137777/kohksh137777/Main.cpp
    
    steps:
    # Ù…Ø±Ø­Ù„Ù‡ 1: Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„
    - name: ğŸ“¥ Checkout Complete Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        submodules: recursive
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: ğŸ—ºï¸ Analyze Repository Structure
      run: |
        echo "ğŸ“ Repository Structure Analysis:"
        echo "==================================="
        find . -type f -name "*.cpp" | head -20
        find . -type f -name "*.h" | head -20
        find . -type f -name "*.hpp" | head -20
        find . -type d -name "Engine" | head -5
        find . -type d -name "Game" | head -5
        echo "Total C++ files: $(find . -name '*.cpp' -o -name '*.h' -o -name '*.hpp' | wc -l)"
        echo "SDL2.zip exists: $(test -f SDL2.zip && echo 'YES' || echo 'NO')"
        echo "Main.cpp exists: $(test -f Main.cpp && echo 'YES' || echo 'NO')"
        
    - name: ğŸ› ï¸ Setup Heavy Development Environment
      uses: android-actions/setup-android@v3
      with:
        api-level: 34
        build-tools: 34.0.0
        ndk: 25.1.8937393
        cmake: 3.22.1
        extra-sdk-components: |
          platforms;android-34
          build-tools;34.0.0
          platform-tools
          ndk;25.1.8937393
          cmake;3.22.1
          patcher;v4
        add-to-path: true
    
    - name: ğŸ’¾ Setup Advanced Caching
      uses: actions/cache@v3
      with:
        path: |
          ~/.gradle/caches
          ~/.gradle/wrapper
          ~/.android/build-cache
          $ANDROID_SDK_ROOT/.downloadIntermediates
          $ANDROID_SDK_ROOT/build-cache
        key: ${{ runner.os }}-heavy-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties', '**/*.cpp', '**/*.h') }}
        restore-keys: |
          ${{ runner.os }}-heavy-

    # Ù…Ø±Ø­Ù„Ù‡ 2: Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø³Ù†Ú¯ÛŒÙ†
    - name: ğŸ“¦ Process Heavy Game Assets
      run: |
        set -e
        echo "ğŸ® PROCESSING KOHKSH HEAVY GAME ENGINE..."
        echo "==========================================="
        
        # Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø§Ø®ØªØ§Ø± Ú©Ø§Ù…Ù„ Ù¾Ø±ÙˆÚ˜Ù‡ Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯
        mkdir -p app/src/main/java/com/kohksh/heavygame/
        mkdir -p app/src/main/cpp/kohksh/engine/core/
        mkdir -p app/src/main/cpp/kohksh/engine/graphics/
        mkdir -p app/src/main/cpp/kohksh/engine/physics/
        mkdir -p app/src/main/cpp/kohksh/engine/audio/
        mkdir -p app/src/main/cpp/kohksh/game/entities/
        mkdir -p app/src/main/cpp/kohksh/game/levels/
        mkdir -p app/src/main/cpp/kohksh/game/ai/
        mkdir -p app/src/main/cpp/kohksh/game/ui/
        mkdir -p app/src/main/cpp/kohksh/platform/android/
        mkdir -p app/src/main/cpp/kohksh/utils/
        mkdir -p app/src/main/assets/shaders/
        mkdir -p app/src/main/assets/textures/
        mkdir -p app/src/main/assets/sounds/
        mkdir -p app/src/main/jniLibs/arm64-v8a/
        mkdir -p app/src/main/jniLibs/armeabi-v7a/
        mkdir -p app/src/main/jniLibs/x86_64/
        mkdir -p app/src/main/res/values/
        mkdir -p app/src/main/res/values-fa/
        mkdir -p app/src/main/res/drawable-hdpi/
        mkdir -p app/src/main/res/drawable-xhdpi/
        mkdir -p app/src/main/res/drawable-xxhdpi/
        mkdir -p app/src/main/res/drawable-xxxhdpi/
        
        echo "ğŸ“ COPYING HEAVY GAME FILES..."
        echo "==============================="
        
        # ØªØ§Ø¨Ø¹ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
        copy_game_assets() {
            local source_dir=$1
            local target_dir=$2
            local description=$3
            
            if [ -d "$source_dir" ]; then
                echo "ğŸ”„ Copying $description from $source_dir to $target_dir"
                
                # Ú©Ù¾ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ C++
                find "$source_dir" -name "*.cpp" -exec cp --parents {} "$target_dir" \; 2>/dev/null || true
                find "$source_dir" -name "*.c" -exec cp --parents {} "$target_dir" \; 2>/dev/null || true
                find "$source_dir" -name "*.h" -exec cp --parents {} "$target_dir" \; 2>/dev/null || true
                find "$source_dir" -name "*.hpp" -exec cp --parents {} "$target_dir" \; 2>/dev/null || true
                
                # Ú©Ù¾ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±
                find "$source_dir" -name "*.glsl" -exec cp --parents {} "$target_dir" \; 2>/dev/null || true
                find "$source_dir" -name "*.vert" -exec cp --parents {} "$target_dir" \; 2>/dev/null || true
                find "$source_dir" -name "*.frag" -exec cp --parents {} "$target_dir" \; 2>/dev/null || true
                find "$source_dir" -name "*.json" -exec cp --parents {} "$target_dir" \; 2>/dev/null || true
                find "$source_dir" -name "*.xml" -exec cp --parents {} "$target_dir" \; 2>/dev/null || true
                
                local cpp_count=$(find "$target_dir" -name "*.cpp" | wc -l)
                local c_count=$(find "$target_dir" -name "*.c" | wc -l)
                local h_count=$(find "$target_dir" -name "*.h" -o -name "*.hpp" | wc -l)
                local other_count=$(find "$target_dir" -name "*.glsl" -o -name "*.vert" -o -name "*.frag" -o -name "*.json" -o -name "*.xml" | wc -l)
                
                echo "âœ… $description: $cpp_count CPP, $c_count C, $h_count Headers, $other_count Other files"
            else
                echo "âŒ Directory not found: $source_dir"
            fi
        }
        
        # Ú©Ù¾ÛŒ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ
        if [ -f "Main.cpp" ]; then
            cp "Main.cpp" "app/src/main/cpp/kohksh/main.cpp"
            echo "âœ… Main.cpp copied to engine core"
        else
            echo "âŒ Main.cpp not found in repository root"
            # Ø§ÛŒØ¬Ø§Ø¯ ÛŒÚ© main.cpp Ù¾ÛŒØ´ÙØ±Ø¶
            cat > app/src/main/cpp/kohksh/main.cpp << 'EOF'
#include <jni.h>
#include <android/log.h>

#define LOG_TAG "KohkshHeavyGame"
#define LOGI(...) __android_log_print(ANDROID_LOG_INFO, LOG_TAG, __VA_ARGS__)

extern "C" JNIEXPORT void JNICALL
Java_com_kohksh_heavygame_MainActivity_startHeavyGame(JNIEnv* env, jobject thiz) {
    LOGI("ğŸš€ Kohksh Heavy Game Engine Started!");
    LOGI("ğŸ® Initializing graphics subsystem...");
    LOGI("âš¡ Loading game assets...");
    LOGI("âœ… Heavy game engine ready!");
}

extern "C" JNIEXPORT jstring JNICALL
Java_com_kohksh_heavygame_MainActivity_getGameVersion(JNIEnv* env, jobject thiz) {
    return env->NewStringUTF("Kohksh Heavy Game v2.0 - Professional Build");
}
EOF
            echo "ğŸ“ Created default main.cpp"
        fi
        
        # Ú©Ù¾ÛŒ Ù…ÙˆØªÙˆØ± Ø¨Ø§Ø²ÛŒ
        copy_game_assets "Engine" "app/src/main/cpp/kohksh/engine" "Engine Files"
        
        # Ú©Ø¯ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
        copy_game_assets "Game" "app/src/main/cpp/kohksh/game" "Game Files"
        
        # Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ SDL2
        if [ -f "SDL2.zip" ]; then
            echo "ğŸ“¦ PROCESSING SDL2 HEAVY LIBRARY..."
            unzip -q "SDL2.zip" -d sdl-heavy-extracted/
            
            # Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ native Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù…Ø¹Ù…Ø§Ø±ÛŒ
            process_heavy_libraries() {
                local arch=$1
                echo "ğŸ”§ Processing $arch libraries..."
                
                # Ú©Ù¾ÛŒ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
                find sdl-heavy-extracted/ -name "libSDL2.so" -exec cp {} "app/src/main/jniLibs/$arch/" \; 2>/dev/null || true
                find sdl-heavy-extracted/ -name "libSDL2_image.so" -exec cp {} "app/src/main/jniLibs/$arch/" \; 2>/dev/null || true
                find sdl-heavy-extracted/ -name "libSDL2_mixer.so" -exec cp {} "app/src/main/jniLibs/$arch/" \; 2>/dev/null || true
                find sdl-heavy-extracted/ -name "libSDL2_ttf.so" -exec cp {} "app/src/main/jniLibs/$arch/" \; 2>/dev/null || true
                find sdl-heavy-extracted/ -name "libopenal.so" -exec cp {} "app/src/main/jniLibs/$arch/" \; 2>/dev/null || true
                
                local lib_count=$(find "app/src/main/jniLibs/$arch/" -name "*.so" | wc -l)
                echo "âœ… $arch: $lib_count libraries"
            }
            
            process_heavy_libraries "arm64-v8a"
            process_heavy_libraries "armeabi-v7a" 
            process_heavy_libraries "x86_64"
            
            # Ú©Ù¾ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‡Ø¯Ø±
            find sdl-heavy-extracted/ -name "*.h" -exec cp --parents {} app/src/main/cpp/ \; 2>/dev/null || true
            find sdl-heavy-extracted/ -name "*.hpp" -exec cp --parents {} app/src/main/cpp/ \; 2>/dev/null || true
            echo "âœ… SDL2 headers copied"
        else
            echo "âš ï¸ SDL2.zip not found, continuing without SDL"
        fi
        
        # Ø¢Ù…Ø§Ø± Ù†Ù‡Ø§ÛŒÛŒ
        echo " "
        echo "ğŸ“Š HEAVY GAME BUILD STATISTICS:"
        echo "================================"
        find app/src/main/cpp/ -name "*.cpp" | wc -l | xargs echo "Total CPP Files:"
        find app/src/main/cpp/ -name "*.c" | wc -l | xargs echo "Total C Files:"
        find app/src/main/cpp/ -name "*.h" -o -name "*.hpp" | wc -l | xargs echo "Total Header Files:"
        find app/src/main/jniLibs/ -name "*.so" | wc -l | xargs echo "Total Native Libraries:"
        echo "Project ready for heavy build!"
            # Ù…Ø±Ø­Ù„Ù‡ 3: Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ
    - name: âš™ï¸ Create Heavy Game Configuration
      run: |
        set -e
        echo "âš™ï¸ CREATING HEAVY GAME CONFIGURATION..."
        echo "========================================"
        
        # Ø§ÛŒØ¬Ø§Ø¯ AndroidManifest.xml Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø³Ù†Ú¯ÛŒÙ†
        cat > app/src/main/AndroidManifest.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <manifest xmlns:android="http://schemas.android.com/apk/res/android"
            xmlns:tools="http://schemas.android.com/tools"
            package="com.kohksh.heavygame">

            <!-- Ù…Ø¬ÙˆØ²Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø³Ù†Ú¯ÛŒÙ† -->
            <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
            <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
            <uses-permission android:name="android.permission.WAKE_LOCK" />
            <uses-permission android:name="android.permission.VIBRATE" />
            <uses-permission android:name="android.permission.INTERNET" />
            <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />

            <!-- Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø³Ø®Øªâ€ŒØ§ÙØ²Ø§Ø±ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ -->
            <uses-feature android:glEsVersion="0x00030002" android:required="true" />
            <uses-feature android:name="android.hardware.sensor.accelerometer" android:required="true" />
            <uses-feature android:name="android.hardware.sensor.gyroscope" android:required="false" />
            <uses-feature android:name="android.hardware.touchscreen" android:required="true" />
            <uses-feature android:name="android.hardware.touchscreen.multitouch" android:required="true" />
            <uses-feature android:name="android.hardware.touchscreen.multitouch.distinct" android:required="false" />

            <application
                android:allowBackup="true"
                android:fullBackupContent="@xml/backup_rules"
                android:label="@string/app_name_heavy"
                android:theme="@style/HeavyGameTheme"
                android:hardwareAccelerated="true"
                android:largeHeap="true"
                android:requestLegacyExternalStorage="true"
                tools:targetApi="31"
                tools:ignore="GoogleAppIndexingWarning">
                
                <activity
                    android:name=".MainActivity"
                    android:configChanges="orientation|keyboardHidden|screenSize|screenLayout|density|uiMode"
                    android:exported="true"
                    android:launchMode="singleTop"
                    android:screenOrientation="sensorLandscape"
                    android:theme="@style/HeavyGameTheme.Fullscreen"
                    android:hardwareAccelerated="true"
                    android:resizeableActivity="true"
                    android:turnScreenOn="true"
                    android:showWhenLocked="true"
                    tools:ignore="LockedOrientationActivity">
                    
                    <intent-filter>
                        <action android:name="android.intent.action.MAIN" />
                        <category android:name="android.intent.category.LAUNCHER" />
                    </intent-filter>
                    
                    <meta-data
                        android:name="android.app.lib_name"
                        android:value="kohksh-heavy-game" />
                </activity>
            </application>
        </manifest>
        EOF

        # Ø§ÛŒØ¬Ø§Ø¯ MainActivity.java Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø³Ù†Ú¯ÛŒÙ†
        cat > app/src/main/java/com/kohksh/heavygame/MainActivity.java << 'EOF'
        package com.kohksh.heavygame;

        import android.app.*;
        import android.os.*;
        import android.view.*;
        import android.content.*;
        import android.util.*;

        public class MainActivity extends Activity {
            
            private static final String TAG = "KohkshHeavyGame";
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ native
            static {
                try {
                    System.loadLibrary("kohksh-heavy-game");
                    Log.i(TAG, "âœ… Main game library loaded");
                } catch (UnsatisfiedLinkError e) {
                    Log.e(TAG, "âŒ Failed to load main game library: " + e.getMessage());
                }
                
                try {
                    System.loadLibrary("sdl2");
                    Log.i(TAG, "âœ… SDL2 library loaded");
                } catch (UnsatisfiedLinkError e) {
                    Log.w(TAG, "âš ï¸ SDL2 library not available: " + e.getMessage());
                }
                
                try {
                    System.loadLibrary("sdl2_image");
                    Log.i(TAG, "âœ… SDL2 Image library loaded");
                } catch (UnsatisfiedLinkError e) {
                    Log.w(TAG, "âš ï¸ SDL2 Image library not available");
                }
                
                try {
                    System.loadLibrary("sdl2_mixer");
                    Log.i(TAG, "âœ… SDL2 Mixer library loaded");
                } catch (UnsatisfiedLinkError e) {
                    Log.w(TAG, "âš ï¸ SDL2 Mixer library not available");
                }
                
                try {
                    System.loadLibrary("sdl2_ttf");
                    Log.i(TAG, "âœ… SDL2 TTF library loaded");
                } catch (UnsatisfiedLinkError e) {
                    Log.w(TAG, "âš ï¸ SDL2 TTF library not available");
                }
            }
            
            // ØªÙˆØ§Ø¨Ø¹ native Ø¨Ø±Ø§ÛŒ Ù…ÙˆØªÙˆØ± Ø¨Ø§Ø²ÛŒ Ø³Ù†Ú¯ÛŒÙ†
            public native void startHeavyGame();
            public native void initializeGameEngine();
            public native void shutdownGameEngine();
            public native void onSurfaceCreated();
            public native void onSurfaceChanged(int width, int height);
            public native void onDrawFrame();
            public native void onTouchEvent(int action, float x, float y);
            public native void onPauseGame();
            public native void onResumeGame();
            public native String getGameVersion();
            public native int getGameStatus();
            
            private SurfaceView gameSurfaceView;
            private boolean gameInitialized = false;
            private boolean surfaceReady = false;
            
            @Override
            protected void onCreate(Bundle savedInstanceState) {
                super.onCreate(savedInstanceState);
                
                Log.i(TAG, "ğŸ® Kohksh Heavy Game Activity - onCreate");
                
                // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
                requestWindowFeature(Window.FEATURE_NO_TITLE);
                getWindow().setFlags(
                    WindowManager.LayoutParams.FLAG_FULLSCREEN,
                    WindowManager.LayoutParams.FLAG_FULLSCREEN
                );
                getWindow().addFlags(
                    WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON |
                    WindowManager.LayoutParams.FLAG_HARDWARE_ACCELERATED
                );
                
                // Ø­Ø§Ù„Øª immersive Ø¨Ø±Ø§ÛŒ ØªØ¬Ø±Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ Ø¨Ù‡ØªØ±
                if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
                    getWindow().getDecorView().setSystemUiVisibility(
                        View.SYSTEM_UI_FLAG_LAYOUT_STABLE |
                        View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION |
                        View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN |
                        View.SYSTEM_UI_FLAG_HIDE_NAVIGATION |
                        View.SYSTEM_UI_FLAG_FULLSCREEN |
                        View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY
                    );
                }
                
                createGameSurface();
                initializeGame();
                
                Log.i(TAG, "âœ… Activity setup completed");
            }
            
            private void createGameSurface() {
                gameSurfaceView = new SurfaceView(this) {
                    private final SurfaceHolder.Callback surfaceCallback = new SurfaceHolder.Callback() {
                        @Override
                        public void surfaceCreated(SurfaceHolder holder) {
                            Log.i(TAG, "ğŸ–¥ï¸ Game surface created");
                            surfaceReady = true;
                            onSurfaceCreated();
                            
                            if (!gameInitialized) {
                                initializeGameEngine();
                                gameInitialized = true;
                            }
                        }
                        
                        @Override
                        public void surfaceChanged(SurfaceHolder holder, int format, int width, int height) {
                            Log.i(TAG, "ğŸ“ Surface changed: " + width + "x" + height);
                            onSurfaceChanged(width, height);
                            
                            if (gameInitialized && surfaceReady) {
                                startGameThread();
                            }
                        }
                        
                        @Override
                        public void surfaceDestroyed(SurfaceHolder holder) {
                            Log.i(TAG, "ğŸ›‘ Surface destroyed");
                            surfaceReady = false;
                            onPauseGame();
                        }
                    };
                    
                    {
                        getHolder().addCallback(surfaceCallback);
                        setFocusable(true);
                        setFocusableInTouchMode(true);
                        setClickable(true);
                        setLongClickable(true);
                    }
                };
                
                setContentView(gameSurfaceView);
                Log.i(TAG, "âœ… Game surface created and set as content view");
            }
            
            private void initializeGame() {
                Log.i(TAG, "ğŸ”§ Initializing game components...");
                
                // Ù†Ù…Ø§ÛŒØ´ Ù†Ø³Ø®Ù‡ Ø¨Ø§Ø²ÛŒ
                String version = getGameVersion();
                Log.i(TAG, "ğŸ¯ Game Version: " + version);
            }
            
            private void startGameThread() {
                Log.i(TAG, "ğŸ® Starting game thread...");
                
                new Thread(() -> {
                    try {
                        Thread.sleep(1000); // ØªØ£Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ
                        startHeavyGame();
                        Log.i(TAG, "âœ… Heavy game started successfully");
                    } catch (Exception e) {
                        Log.e(TAG, "âŒ Failed to start game: " + e.getMessage());
                    }
                }).start();
            }
            
            @Override
            public boolean onTouchEvent(MotionEvent event) {
                int action = event.getActionMasked();
                float x = event.getX();
                float y = event.getY();
                
                onTouchEvent(action, x, y);
                return true;
            }
            
            @Override
            protected void onPause() {
                super.onPause();
                Log.i(TAG, "â¸ï¸ Activity paused");
                onPauseGame();
            }
            
            @Override
            protected void onResume() {
                super.onResume();
                Log.i(TAG, "â–¶ï¸ Activity resumed");
                
                if (gameInitialized) {
                    onResumeGame();
                }
            }
            
            @Override
            protected void onDestroy() {
                super.onDestroy();
                Log.i(TAG, "ğŸ—‘ï¸ Activity destroyed");
                shutdownGameEngine();
            }
            
            // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ
            public int getCurrentGameStatus() {
                return getGameStatus();
            }
        }
        EOF

        # Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ resource Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø³Ù†Ú¯ÛŒÙ†
        echo "ğŸ¨ CREATING HEAVY GAME RESOURCES..."
        
        # Ø§ÛŒØ¬Ø§Ø¯ strings.xml
        cat > app/src/main/res/values/strings.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <string name="app_name_heavy">Kohksh Heavy Game</string>
            <string name="game_title">Kohksh Engine Pro</string>
            <string name="loading_message">Initializing Heavy Game Engineâ€¦</string>
            <string name="game_version">Professional Edition</string>
            <string name="exit_message">Are you sure you want to exit the game?</string>
        </resources>
        EOF
        
        # Ø§ÛŒØ¬Ø§Ø¯ strings.xml ÙØ§Ø±Ø³ÛŒ
        cat > app/src/main/res/values-fa/strings.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <string name="app_name_heavy">Ø¨Ø§Ø²ÛŒ Ø³Ù†Ú¯ÛŒÙ† Ú©ÙˆÙ‡Ú©Ø´</string>
            <string name="loading_message">Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…ÙˆØªÙˆØ± Ø¨Ø§Ø²ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡â€¦</string>
        </resources>
        EOF
        
        # Ø§ÛŒØ¬Ø§Ø¯ styles.xml
        cat > app/src/main/res/values/styles.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <style name="HeavyGameTheme" parent="Theme.AppCompat.Light.DarkActionBar">
                <item name="colorPrimary">@color/colorPrimary</item>
                <item name="colorPrimaryDark">@color/colorPrimaryDark</item>
                <item name="colorAccent">@color/colorAccent</item>
                <item name="android:windowBackground">@color/windowBackground</item>
                <item name="android:statusBarColor">@color/colorPrimaryDark</item>
            </style>
            
            <style name="HeavyGameTheme.Fullscreen" parent="HeavyGameTheme">
                <item name="android:windowNoTitle">true</item>
                <item name="android:windowActionBar">false</item>
                <item name="android:windowFullscreen">true</item>
                <item name="android:windowContentOverlay">@null</item>
                <item name="android:windowBackground">@android:color/black</item>
                <item name="android:statusBarColor">@android:color/transparent</item>
            </style>
        </resources>
        EOF
        
        # Ø§ÛŒØ¬Ø§Ø¯ colors.xml
        cat > app/src/main/res/values/colors.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <color name="colorPrimary">#2196F3</color>
            <color name="colorPrimaryDark">#1976D2</color>
            <color name="colorAccent">#FF9800</color>
            <color name="windowBackground">#F5F5F5</color>
        </resources>
        EOF

        echo "âœ… Heavy game configuration completed"
            # Ø§ÛŒØ¬Ø§Ø¯ CMakeLists.txt Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø³Ù†Ú¯ÛŒÙ†
    - name: ğŸ”§ Create Advanced CMake Configuration
      run: |
        echo "ğŸ”§ CREATING ADVANCED CMAKE CONFIGURATION..."
        cat > app/src/main/cpp/CMakeLists.txt << 'EOF'
        # CMake Configuration for Kohksh Heavy Game Engine
        cmake_minimum_required(VERSION 3.18.1)
        
        # Ù¾Ø±ÙˆÚ˜Ù‡ Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²ÛŒ Ø³Ù†Ú¯ÛŒÙ†
        project("kohksh-heavy-game")
        
        # ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ú©Ø§Ù…Ù¾Ø§ÛŒÙ„Ø±
        set(CMAKE_CXX_STANDARD 17)
        set(CMAKE_CXX_STANDARD_REQUIRED ON)
        set(CMAKE_CXX_EXTENSIONS OFF)
        
        # ÙÙ„Ú¯â€ŒÙ‡Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ø§Ù„Ø§
        set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -O3 -ffast-math -fno-exceptions -fno-rtti")
        set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -Wextra -Wpedantic")
        set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fvisibility=hidden -fvisibility-inlines-hidden")
        set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DGL_GLEXT_PROTOTYPES -DEGL_EGLEXT_PROTOTYPES")
        
        # ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø®Ø§Øµ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ù‡ØªØ±
        if(ANDROID_ABI STREQUAL "arm64-v8a")
            set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -march=armv8-a+crc+crypto+simd")
            set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -mtune=cortex-a75")
        elseif(ANDROID_ABI STREQUAL "armeabi-v7a")
            set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -march=armv7-a -mfpu=neon -mfloat-abi=softfp")
            set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -mthumb")
        elseif(ANDROID_ABI STREQUAL "x86_64")
            set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -march=x86-64 -msse4.2 -mpopcnt")
        endif()
        
        # Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯
        find_library(log-lib log)
        find_library(android-lib android)
        find_library(glesv2-lib GLESv2)
        find_library(egl-lib EGL)
        find_library(openal-lib OpenAL)
        
        # Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ ØªÙ…Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø¨Ø¹ Ø¨Ø§Ø²ÛŒ
        file(GLOB_RECURSE KOHKSH_MAIN_SOURCES "kohksh/main.cpp")
        file(GLOB_RECURSE ENGINE_CORE_SOURCES "kohksh/engine/core/*.cpp" "kohksh/engine/core/*.c")
        file(GLOB_RECURSE ENGINE_GRAPHICS_SOURCES "kohksh/engine/graphics/*.cpp" "kohksh/engine/graphics/*.c")
        file(GLOB_RECURSE ENGINE_PHYSICS_SOURCES "kohksh/engine/physics/*.cpp" "kohksh/engine/physics/*.c")
        file(GLOB_RECURSE ENGINE_AUDIO_SOURCES "kohksh/engine/audio/*.cpp" "kohksh/engine/audio/*.c")
        file(GLOB_RECURSE GAME_ENTITIES_SOURCES "kohksh/game/entities/*.cpp" "kohksh/game/entities/*.c")
        file(GLOB_RECURSE GAME_LEVELS_SOURCES "kohksh/game/levels/*.cpp" "kohksh/game/levels/*.c")
        file(GLOB_RECURSE GAME_AI_SOURCES "kohksh/game/ai/*.cpp" "kohksh/game/ai/*.c")
        file(GLOB_RECURSE GAME_UI_SOURCES "kohksh/game/ui/*.cpp" "kohksh/game/ui/*.c")
        file(GLOB_RECURSE PLATFORM_SOURCES "kohksh/platform/android/*.cpp" "kohksh/platform/android/*.c")
        file(GLOB_RECURSE UTILS_SOURCES "kohksh/utils/*.cpp" "kohksh/utils/*.c")
        
        # Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²ÛŒ Ø³Ù†Ú¯ÛŒÙ†
        add_library(kohksh-heavy-game SHARED
            ${KOHKSH_MAIN_SOURCES}
            ${ENGINE_CORE_SOURCES}
            ${ENGINE_GRAPHICS_SOURCES}
            ${ENGINE_PHYSICS_SOURCES}
            ${ENGINE_AUDIO_SOURCES}
            ${GAME_ENTITIES_SOURCES}
            ${GAME_LEVELS_SOURCES}
            ${GAME_AI_SOURCES}
            ${GAME_UI_SOURCES}
            ${PLATFORM_SOURCES}
            ${UTILS_SOURCES}
        )
        
        # Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒâ€ŒÙ‡Ø§ÛŒ include Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù…Ù¾Ø§ÛŒÙ„Ø±
        target_include_directories(kohksh-heavy-game PRIVATE
            ${CMAKE_CURRENT_SOURCE_DIR}
            ${CMAKE_CURRENT_SOURCE_DIR}/kohksh
            ${CMAKE_CURRENT_SOURCE_DIR}/kohksh/engine
            ${CMAKE_CURRENT_SOURCE_DIR}/kohksh/engine/core
            ${CMAKE_CURRENT_SOURCE_DIR}/kohksh/engine/graphics
            ${CMAKE_CURRENT_SOURCE_DIR}/kohksh/engine/physics
            ${CMAKE_CURRENT_SOURCE_DIR}/kohksh/engine/audio
            ${CMAKE_CURRENT_SOURCE_DIR}/kohksh/game
            ${CMAKE_CURRENT_SOURCE_DIR}/kohksh/game/entities
            ${CMAKE_CURRENT_SOURCE_DIR}/kohksh/game/levels
            ${CMAKE_CURRENT_SOURCE_DIR}/kohksh/game/ai
            ${CMAKE_CURRENT_SOURCE_DIR}/kohksh/game/ui
            ${CMAKE_CURRENT_SOURCE_DIR}/kohksh/platform/android
            ${CMAKE_CURRENT_SOURCE_DIR}/kohksh/utils
        )
        
        # Ù„ÛŒÙ†Ú© Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²
        target_link_libraries(kohksh-heavy-game
            ${log-lib}
            ${android-lib}
            ${glesv2-lib}
            ${egl-lib}
            ${openal-lib}
        )
        
        # properties Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ
        set_target_properties(kohksh-heavy-game PROPERTIES
            LIBRARY_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/../../../jniLibs/${ANDROID_ABI}
            CXX_EXTENSIONS OFF
            POSITION_INDEPENDENT_CODE TRUE
        )
        
        # Ù¾ÛŒØ§Ù… Ù¾Ø§ÛŒØ§Ù†ÛŒ
        message("ğŸ¯ Kohksh Heavy Game CMake configuration completed")
        message("ğŸ“Š Source files: ${ENGINE_CORE_SOURCES} ${ENGINE_GRAPHICS_SOURCES} ${GAME_ENTITIES_SOURCES}")
        EOF

        echo "âœ… Advanced CMake configuration created"

    # Ø§ÛŒØ¬Ø§Ø¯ Gradle configuration Ù¾ÛŒØ´Ø±ÙØªÙ‡
    - name: ğŸ“¦ Create Professional Gradle Setup
      run: |
        echo "ğŸ“¦ CREATING PROFESSIONAL GRADLE SETUP..."
        
        # Ø§ÛŒØ¬Ø§Ø¯ app/build.gradle Ù¾ÛŒØ´Ø±ÙØªÙ‡
        cat > app/build.gradle << 'EOF'
        plugins {
            id 'com.android.application'
            id 'org.jetbrains.kotlin.android'
        }
        
        android {
            namespace 'com.kohksh.heavygame'
            compileSdk 34
            
            defaultConfig {
                applicationId "com.kohksh.heavygame"
                minSdk 24
                targetSdk 34
                versionCode 1
                versionName "2.0.0"
                
                externalNativeBuild {
                    cmake {
                        cppFlags '-std=c++17 -O3 -ffast-math -fno-exceptions -fno-rtti'
                        arguments "-DANDROID_STL=c++_shared",
                                 "-DANDROID_CPP_FEATURES=rtti exceptions",
                                 "-DANDROID_TOOLCHAIN=clang",
                                 "-DANDROID_PLATFORM=android-24",
                                 "-DANDROID_ARM_NEON=TRUE"
                    }
                }
                
                ndk {
                    abiFilters 'arm64-v8a', 'armeabi-v7a', 'x86_64'
                    debugSymbolLevel 'FULL'
                }
            }
            
            buildTypes {
                debug {
                    debuggable true
                    jniDebuggable true
                    minifyEnabled false
                    proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
                }
                release {
                    minifyEnabled true
                    shrinkResources true
                    proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
                    ndk {
                        debugSymbolLevel 'FULL'
                    }
                }
            }
            
            compileOptions {
                sourceCompatibility JavaVersion.VERSION_17
                targetCompatibility JavaVersion.VERSION_17
            }
            
            kotlinOptions {
                jvmTarget = '17'
            }
            
            externalNativeBuild {
                cmake {
                    path "src/main/cpp/CMakeLists.txt"
                    version "3.22.1"
                }
            }
            
            sourceSets {
                main {
                    jniLibs.srcDirs = ['src/main/jniLibs']
                    assets.srcDirs = ['src/main/assets']
                }
            }
            
            packagingOptions {
                jniLibs {
                    useLegacyPackaging true
                }
                resources {
                    excludes += ['META-INF/DEPENDENCIES', 'META-INF/LICENSE', 'META-INF/LICENSE.txt', 'META-INF/NOTICE']
                }
            }
        }
        
        dependencies {
            implementation 'androidx.core:core-ktx:1.12.0'
            implementation 'androidx.appcompat:appcompat:1.6.1'
            implementation 'com.google.android.material:material:1.10.0'
            implementation 'androidx.constraintlayout:constraintlayout:2.1.4'
        }
        EOF
        
        # Ø§ÛŒØ¬Ø§Ø¯ settings.gradle
        echo "include ':app'" > settings.gradle
        
        # Ø§ÛŒØ¬Ø§Ø¯ gradle.properties
        cat > gradle.properties << 'EOF'
        org.gradle.jvmargs=-Xmx4g -XX:MaxMetaspaceSize=1g
        org.gradle.parallel=true
        org.gradle.caching=true
        org.gradle.configureondemand=true
        android.useAndroidX=true
        android.enableJetifier=true
        kotlin.code.style=official
        EOF
        
        # Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ gradlew Ø³Ø§Ø¯Ù‡
        cat > gradlew << 'EOF'
        #!/bin/sh
        # Kohksh Heavy Game Gradle Wrapper
        echo "ğŸ® Kohksh Heavy Game - Gradle Wrapper"
        echo "ğŸ”§ Building professional game APK..."
        exec gradle "$@"
        EOF
        chmod +x gradlew
        
        echo "âœ… Professional Gradle setup completed"

    # Ù…Ø±Ø­Ù„Ù‡ Ù†Ù‡Ø§ÛŒÛŒ: Ø³Ø§Ø®Øª Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ
    - name: ğŸ—ï¸ Build Heavy Game APK
      run: |
        echo "ğŸ—ï¸ STARTING HEAVY GAME APK BUILD..."
        echo "===================================="
        
        # Ø³Ø§Ø®Øª Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡
        ./gradlew clean assembleDebug \
            --build-cache \
            --parallel \
            --configure-on-demand \
            --max-workers=4 \
            --stacktrace \
            --info
        
        echo "âœ… Build process completed"
        
    - name: ğŸ“Š Build Results Analysis
      run: |
        echo "ğŸ“Š BUILD RESULTS ANALYSIS:"
        echo "==========================="
        
        # Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡
        if [ -f "app/build/outputs/apk/debug/app-debug.apk" ]; then
            echo "ğŸ‰ SUCCESS: APK file created!"
            ls -la app/build/outputs/apk/debug/app-debug.apk
            echo "APK Size: $(du -h app/build/outputs/apk/debug/app-debug.apk | cut -f1)"
        else
            echo "âŒ APK file not found in expected location"
            echo "Searching for APK files..."
            find . -name "*.apk" -type f 2>/dev/null || echo "No APK files found"
        fi
        
        # Ø¨Ø±Ø±Ø³ÛŒ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ native
        echo " "
        echo "ğŸ“ Native Libraries:"
        find app/src/main/jniLibs -name "*.so" 2>/dev/null | head -10
        
        # Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ C++
        echo " "
        echo "ğŸ“ C++ Source Files:"
        find app/src/main/cpp -name "*.cpp" -o -name "*.c" | wc -l | xargs echo "Total Source Files:"
        
    - name: ğŸ“± Upload Heavy Game APK
      uses: actions/upload-artifact@v4
      with:
        name: kohksh-heavy-game-professional
        path: |
          app/build/outputs/apk/**/*.apk
          app/build/outputs/native-debug-symbols/**/*.so
        retention-days: 30
        if-no-files-found: error
        
    - name: ğŸ¯ Final Success Message
      if: success()
      run: |
        echo " "
        echo "ğŸ‰ğŸ‰ğŸ‰ KOHKSH HEAVY GAME BUILD SUCCESSFUL! ğŸ‰ğŸ‰ğŸ‰"
        echo "================================================"
        echo "âœ… Professional APK created successfully"
        echo "âœ… Heavy game engine compiled"
        echo "âœ… All assets processed"
        echo "âœ… Ready for installation on Android devices"
        echo " "
        echo "ğŸ“± Download the APK from the Artifacts section"
        echo "ğŸ® Install and enjoy your heavy graphics game!"
        echo " "
