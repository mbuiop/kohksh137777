name: Build Android APK

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Build with Docker
      run: |
        echo "ðŸ³ Building with Docker container..."
        
        # Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Docker image Ú©Ù‡ Ù‡Ù…Ù‡ Ú†ÛŒØ² Ù†ØµØ¨ Ø¯Ø§Ø±Ù‡
        docker run --rm -v $PWD:/app -w /app \
          android-builder:latest \
          /bin/bash -c "
            echo 'ðŸ“¦ Setting up project...'
            
            # Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø±ÙˆÚ˜Ù‡
            mkdir -p app/src/main/cpp/
            mkdir -p app/src/main/java/com/kohksh/
            
            # Ú©Ù¾ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
            cp Main.cpp app/src/main/cpp/
            cp -r Engine/* app/src/main/cpp/ 2>/dev/null || true
            cp -r Game/* app/src/main/cpp/ 2>/dev/null || true
            
            # Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ
            cat > app/src/main/java/com/kohksh/MainActivity.java << 'EOF'
            package com.kohksh;
            import android.app.*;
            import android.os.*;
            
            public class MainActivity extends Activity {
                static { System.loadLibrary('kohksh'); }
                public native void startKohksh();
                
                @Override
                protected void onCreate(Bundle savedInstanceState) {
                    super.onCreate(savedInstanceState);
                    new Thread(() -> startKohksh()).start();
                }
            }
            EOF
            
            # Ø³Ø§Ø®Øª APK
            cd app && ./gradlew assembleDebug --stacktrace
          "
          
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: kohksh-game
        path: app/build/outputs/apk/debug/app-debug.apk
