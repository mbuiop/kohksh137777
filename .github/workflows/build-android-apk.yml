    - name: ðŸ› ï¸ Setup Ultimate Android Environment
      uses: android-actions/setup-android@v3
      with:
        accept-android-sdk-licenses: true
        packages: |
          platform-tools
          platforms;android-34
          build-tools;34.0.0
          ndk;25.1.8937393
          cmake;3.22.1

    
    - name: ðŸ’¾ Setup Mega Caching System
      uses: actions/cache@v3
      with:
        path: |
          ~/.gradle/caches
          ~/.gradle/wrapper
          ~/.android/build-cache
          $ANDROID_SDK_ROOT/.downloadIntermediates
          $ANDROID_SDK_ROOT/build-cache
        key: ${{ runner.os }}-ultimate-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
        restore-keys: |
          ${{ runner.os }}-ultimate-
    
    # Ù…Ø±Ø­Ù„Ù‡ 2: Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø³Ù†Ú¯ÛŒÙ† Ø¨Ø§Ø²ÛŒ
    - name: ðŸ“¦ Process Heavy Game Assets & Code
      run: |
        set -e
        echo "ðŸŽ® Processing Kohksh Ultimate Game Engine..."
        
        # Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø§Ø®ØªØ§Ø± Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ú©Ø§Ù…Ù„
        mkdir -p app/src/main/java/com/kohksh/ultimate/engine/
        mkdir -p app/src/main/cpp/core/engine/
        mkdir -p app/src/main/cpp/core/physics/
        mkdir -p app/src/main/cpp/core/graphics/
        mkdir -p app/src/main/cpp/core/audio/
        mkdir -p app/src/main/cpp/game/entities/
        mkdir -p app/src/main/cpp/game/levels/
        mkdir -p app/src/main/cpp/game/ai/
        mkdir -p app/src/main/cpp/utils/
        mkdir -p app/src/main/cpp/platform/
        mkdir -p app/src/main/assets/shaders/opengl/
        mkdir -p app/src/main/assets/shaders/vulkan/
        mkdir -p app/src/main/assets/textures/hd/
        mkdir -p app/src/main/assets/textures/compressed/
        mkdir -p app/src/main/assets/sounds/music/
        mkdir -p app/src/main/assets/sounds/effects/
        mkdir -p app/src/main/assets/fonts/
        mkdir -p app/src/main/res/values/
        mkdir -p app/src/main/res/values-fa/
        mkdir -p app/src/main/jniLibs/arm64-v8a/
        mkdir -p app/src/main/jniLibs/armeabi-v7a/
        mkdir -p app/src/main/jniLibs/x86_64/
        mkdir -p app/src/main/jniLibs/x86/
        
        echo "ðŸ“ Scanning and copying heavy game files..."
        
        # Ø³ÛŒØ³ØªÙ… Ú©Ù¾ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
        copy_game_files() {
          local source_dir=$1
          local target_dir=$2
          local file_type=$3
          
          if [ -d "$source_dir" ]; then
            find "$source_dir" -name "*.$file_type" -exec cp --parents {} "$target_dir" \; 2>/dev/null || true
            local count=$(find "$target_dir" -name "*.$file_type" | wc -l)
            echo "âœ… $file_type files from $source_dir: $count files"
          else
            echo "âš ï¸ Directory $source_dir not found"
          fi
        }
        
        # Ú©Ù¾ÛŒ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ
        if [ -f "Main.cpp" ]; then
          cp "Main.cpp" app/src/main/cpp/core/engine/main.cpp
          echo "âœ… Main.cpp copied to engine core"
        fi
        
        # Ú©Ù¾ÛŒ Ù…ÙˆØªÙˆØ± Ø¨Ø§Ø²ÛŒ
        copy_game_files "Engine" "app/src/main/cpp/core" "cpp"
        copy_game_files "Engine" "app/src/main/cpp/core" "c"
        copy_game_files "Engine" "app/src/main/cpp/core" "h"
        copy_game_files "Engine" "app/src/main/cpp/core" "hpp"
        
        # Ú©Ù¾ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
        copy_game_files "Game" "app/src/main/cpp/game" "cpp"
        copy_game_files "Game" "app/src/main/cpp/game" "c"
        copy_game_files "Game" "app/src/main/cpp/game" "h"
        copy_game_files "Game" "app/src/main/cpp/game" "hpp"
        
        # Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ SDL2
        if [ -f "SDL2.zip" ]; then
          echo "ðŸ“¦ Extracting and processing SDL2 ultimate library..."
          unzip -q "SDL2.zip" -d sdl-ultimate-extracted/
          
          # Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ native
          process_native_libs() {
            local arch=$1
            find sdl-ultimate-extracted/ -name "libSDL2.so" -exec cp {} "app/src/main/jniLibs/$arch/" \; 2>/dev/null || true
            find sdl-ultimate-extracted/ -name "libSDL2_image.so" -exec cp {} "app/src/main/jniLibs/$arch/" \; 2>/dev/null || true
            find sdl-ultimate-extracted/ -name "libSDL2_mixer.so" -exec cp {} "app/src/main/jniLibs/$arch/" \; 2>/dev/null || true
            find sdl-ultimate-extracted/ -name "libSDL2_ttf.so" -exec cp {} "app/src/main/jniLibs/$arch/" \; 2>/dev/null || true
            echo "âœ… $arch libraries: $(find app/src/main/jniLibs/$arch/ -name '*.so' | wc -l) files"
          }
          
          process_native_libs "arm64-v8a"
          process_native_libs "armeabi-v7a"
          process_native_libs "x86_64"
          process_native_libs "x86"
          
          # Ú©Ù¾ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‡Ø¯Ø±
          find sdl-ultimate-extracted/ -name "*.h" -exec cp --parents {} app/src/main/cpp/ \; 2>/dev/null || true
          echo "âœ… SDL2 headers copied"
        fi
        
        # Ø¢Ù…Ø§Ø± Ù†Ù‡Ø§ÛŒÛŒ
        echo "ðŸ“Š ULTIMATE BUILD STATISTICS:"
        echo "=============================="
        find app/src/main/cpp/ -name "*.cpp" -o -name "*.c" | wc -l | xargs echo "Total Source Files:"
        find app/src/main/cpp/ -name "*.h" -o -name "*.hpp" | wc -l | xargs echo "Total Header Files:"
        find app/src/main/jniLibs/ -name "*.so" | wc -l | xargs echo "Total Native Libraries:"
        echo "Project Structure Ready for Ultimate Build!"
    
    # Ù…Ø±Ø­Ù„Ù‡ 3: Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ
    - name: âš™ï¸ Create Ultimate Configuration Files
      run: |
        set -e
        echo "âš™ï¸ Creating ultimate professional configuration..."
        
        # Ø§ÛŒØ¬Ø§Ø¯ AndroidManifest.xml Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ú©Ø§Ù…Ù„
        cat > app/src/main/AndroidManifest.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <manifest xmlns:android="http://schemas.android.com/apk/res/android"
            xmlns:tools="http://schemas.android.com/tools"
            package="com.kohksh.ultimategame">
            
            <!-- Ù…Ø¬ÙˆØ²Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø³Ù†Ú¯ÛŒÙ† -->
            <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
            <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
            <uses-permission android:name="android.permission.WAKE_LOCK" />
            <uses-permission android:name="android.permission.VIBRATE" />
            <uses-permission android:name="android.permission.INTERNET" />
            
            <!-- Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø³Ø®Øªâ€ŒØ§ÙØ²Ø§Ø±ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ -->
            <uses-feature android:glEsVersion="0x00030002" android:required="true" />
            <uses-feature android:name="android.hardware.sensor.accelerometer" android:required="true" />
            <uses-feature android:name="android.hardware.touchscreen" android:required="true" />
            <uses-feature android:name="android.hardware.touchscreen.multitouch" android:required="true" />
            
            <application
                android:allowBackup="true"
                android:label="@string/app_name_ultimate"
                android:theme="@style/UltimateAppTheme"
                android:hardwareAccelerated="true"
                android:largeHeap="true"
                tools:targetApi="31">
                
                <activity
                    android:name=".UltimateMainActivity"
                    android:configChanges="orientation|keyboardHidden|screenSize|screenLayout|density|uiMode"
                    android:exported="true"
                    android:launchMode="singleTop"
                    android:screenOrientation="sensorLandscape"
                    android:theme="@style/UltimateAppTheme.Fullscreen"
                    android:hardwareAccelerated="true"
                    tools:ignore="LockedOrientationActivity">
                    <intent-filter>
                        <action android:name="android.intent.action.MAIN" />
                        <category android:name="android.intent.category.LAUNCHER" />
                    </intent-filter>
                    
                    <meta-data
                        android:name="android.app.lib_name"
                        android:value="kohksh-ultimate-engine" />
                </activity>
            </application>
        </manifest>
        EOF

    # Ø§ÛŒØ¬Ø§Ø¯ MainActivity.java Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ
    - name: ðŸ’» Create Ultimate Java Code
      run: |
        cat > app/src/main/java/com/kohksh/ultimategame/UltimateMainActivity.java << 'EOF'
        package com.kohksh.ultimategame;

        import android.app.*;
        import android.os.*;
        import android.view.*;
        import android.content.*;
        import android.util.*;

        public class UltimateMainActivity extends Activity {
            
            private static final String TAG = "KohkshUltimateGame";
            
            // Load native libraries
            static {
                System.loadLibrary("kohksh-ultimate-engine");
                System.loadLibrary("sdl2");
            }
            
            // Native methods for heavy game engine
            public native boolean initUltimateEngine();
            public native void startUltimateGameLoop();
            public native void shutdownUltimateEngine();
            public native void onUltimateSurfaceCreated();
            public native void onUltimateSurfaceChanged(int width, int height);
            
            private SurfaceView ultimateGameSurface;
            private boolean engineInitialized = false;
            
            @Override
            protected void onCreate(Bundle savedInstanceState) {
                super.onCreate(savedInstanceState);
                
                // Ultimate fullscreen setup
                requestWindowFeature(Window.FEATURE_NO_TITLE);
                getWindow().setFlags(
                    WindowManager.LayoutParams.FLAG_FULLSCREEN,
                    WindowManager.LayoutParams.FLAG_FULLSCREEN
                );
                getWindow().addFlags(WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON);
                
                createGameSurface();
                
                Log.i(TAG, "Kohksh Ultimate Game Activity created successfully");
            }
            
            private void createGameSurface() {
                ultimateGameSurface = new SurfaceView(this) {
                    private final SurfaceHolder.Callback surfaceCallback = new SurfaceHolder.Callback() {
                        @Override
                        public void surfaceCreated(SurfaceHolder holder) {
                            Log.i(TAG, "Ultimate Game Surface created");
                            onUltimateSurfaceCreated();
                            initializeEngine();
                        }
                        
                        @Override
                        public void surfaceChanged(SurfaceHolder holder, int format, int width, int height) {
                            Log.i(TAG, "Surface changed: " + width + "x" + height);
                            onUltimateSurfaceChanged(width, height);
                        }
                        
                        @Override
                        public void surfaceDestroyed(SurfaceHolder holder) {
                            Log.i(TAG, "Surface destroyed");
                        }
                    };
                    
                    {
                        getHolder().addCallback(surfaceCallback);
                        setFocusable(true);
                        setFocusableInTouchMode(true);
                    }
                };
                
                setContentView(ultimateGameSurface);
            }
            
            private void initializeEngine() {
                if (!engineInitialized) {
                    new Thread(() -> {
                        boolean success = initUltimateEngine();
                        
                        if (success) {
                            engineInitialized = true;
                            startUltimateGameLoop();
                            Log.i(TAG, "Ultimate game engine initialized successfully");
                        } else {
                            Log.e(TAG, "Failed to initialize game engine");
                        }
                    }).start();
                }
            }
            
            @Override
            protected void onPause() {
                super.onPause();
            }
            
            @Override
            protected void onDestroy() {
                shutdownUltimateEngine();
                super.onDestroy();
                Log.i(TAG, "Ultimate game activity destroyed");
            }
        }
        EOF

    # Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ resource
    - name: ðŸŽ¨ Create Ultimate Resources
      run: |
        # Ø§ÛŒØ¬Ø§Ø¯ strings.xml
        cat > app/src/main/res/values/strings.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <string name="app_name_ultimate">Kohksh Ultimate Game</string>
            <string name="game_title">Kohksh Engine v3.0</string>
            <string name="loading_message">Initializing Ultimate Game Engineâ€¦</string>
        </resources>
        EOF
        
        # Ø§ÛŒØ¬Ø§Ø¯ styles.xml
        cat > app/src/main/res/values/styles.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <style name="UltimateAppTheme" parent="Theme.AppCompat.Light.DarkActionBar">
                <item name="colorPrimary">@color/colorPrimary</item>
                <item name="colorPrimaryDark">@color/colorPrimaryDark</item>
                <item name="colorAccent">@color/colorAccent</item>
            </style>
            
            <style name="UltimateAppTheme.Fullscreen" parent="UltimateAppTheme">
                <item name="android:windowNoTitle">true</item>
                <item name="android:windowActionBar">false</item>
                <item name="android:windowFullscreen">true</item>
                <item name="android:windowContentOverlay">@null</item>
            </style>
        </resources>
        EOF
        
        # Ø§ÛŒØ¬Ø§Ø¯ colors.xml
        cat > app/src/main/res/values/colors.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <color name="colorPrimary">#2E7D32</color>
            <color name="colorPrimaryDark">#1B5E20</color>
            <color name="colorAccent">#FF6D00</color>
        </resources>
        EOF

    # Ø§ÛŒØ¬Ø§Ø¯ CMakeLists.txt Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ
    - name: ðŸ”§ Create Ultimate CMake Configuration
      run: |
        cat > app/src/main/cpp/CMakeLists.txt << 'EOF'
        cmake_minimum_required(VERSION 3.18.1)
        project("kohksh-ultimate-engine")
        
        set(CMAKE_CXX_STANDARD 17)
        set(CMAKE_CXX_STANDARD_REQUIRED ON)
        
        # ÙÙ„Ú¯â€ŒÙ‡Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ
        set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -O2 -ffast-math")
        
        # Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…
        find_library(log-lib log)
        find_library(android-lib android)
        find_library(glesv2-lib GLESv2)
        
        # Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ ØªÙ…Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø¨Ø¹
        file(GLOB_RECURSE ENGINE_SOURCES "core/*.cpp" "core/*.c")
        file(GLOB_RECURSE GAME_SOURCES "game/*.cpp" "game/*.c")
        
        # Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø§ØµÙ„ÛŒ Ù…ÙˆØªÙˆØ±
        add_library(kohksh-ultimate-engine SHARED
            ${ENGINE_SOURCES}
            ${GAME_SOURCES}
        )
        
        # include directories
        target_include_directories(kohksh-ultimate-engine PRIVATE
            ${CMAKE_CURRENT_SOURCE_DIR}
        )
        
        # Ù„ÛŒÙ†Ú© Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§
        target_link_libraries(kohksh-ultimate-engine
            ${log-lib}
            ${android-lib}
            ${glesv2-lib}
        )
        EOF

    # Ø§ÛŒØ¬Ø§Ø¯ Gradle configuration Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ
    - name: ðŸ“¦ Create Ultimate Gradle Setup
      run: |
        cat > app/build.gradle << 'EOF'
        plugins {
            id 'com.android.application'
        }
        
        android {
            namespace 'com.kohksh.ultimategame'
            compileSdk 34
            
            defaultConfig {
                applicationId "com.kohksh.ultimategame"
                minSdk 24
                targetSdk 34
                versionCode 1
                versionName "3.0.0"
                
                externalNativeBuild {
                    cmake {
                        cppFlags '-std=c++17 -O2'
                        arguments "-DANDROID_STL=c++_shared"
                    }
                }
                
                ndk {
                    abiFilters 'arm64-v8a', 'armeabi-v7a', 'x86_64'
                }
            }
            
            buildTypes {
                debug {
                    debuggable true
                    jniDebuggable true
                    minifyEnabled false
                }
            }
            
            externalNativeBuild {
                cmake {
                    path "src/main/cpp/CMakeLists.txt"
                    version "3.22.1"
                }
            }
        }
        EOF
        
        # Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ú¯Ø±Ø§Ø¯Ù„ Ø§ØµÙ„ÛŒ
        echo "include ':app'" > settings.gradle
        
        cat > build.gradle << 'EOF'
        buildscript {
            repositories {
                google()
                mavenCentral()
            }
            dependencies {
                classpath 'com.android.tools.build:gradle:8.0.0'
            }
        }
        
        allprojects {
            repositories {
                google()
                mavenCentral()
            }
        }
        
        task clean(type: Delete) {
            delete rootProject.buildDir
        }
        EOF

    # Ù…Ø±Ø­Ù„Ù‡ Ù†Ù‡Ø§ÛŒÛŒ: Ø³Ø§Ø®Øª
    - name: ðŸ—ï¸ Build Ultimate APK
      run: |
        echo "ðŸ—ï¸ Starting ultimate APK build..."
        chmod +x gradlew
        ./gradlew clean assembleDebug --stacktrace --no-daemon
        
    - name: ðŸ“± Upload Ultimate APK
      uses: actions/upload-artifact@v4
      with:
        name: kohksh-ultimate-game
        path: app/build/outputs/apk/debug/app-debug.apk
        retention-days: 30
