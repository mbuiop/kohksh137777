name: Build SDL Android APK

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Android SDK
      uses: android-actions/setup-android@v3
      
    - name: Download SDL2 for Android
      run: |
        mkdir -p jni/SDL2
        wget https://github.com/libsdl-org/SDL/releases/download/release-2.28.5/SDL2-2.28.5.tar.gz
        tar -xzf SDL2-2.28.5.tar.gz
        cp -r SDL2-2.28.5/android-project/app/jni/SDL2/* jni/SDL2/
        
    - name: Make gradlew executable
      run: chmod +x ./gradlew
      
    - name: Build APK with SDL2
      run: |
        ./gradlew assembleDebug --stacktrace --info
        
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: kohksh-sdl-apk
        path: app/build/outputs/apk/debug/app-debug.apk
        retention-days: 30
